<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Lims::Core::Persistence::Persistor
  
    &mdash; Documentation by YARD 0.7.3
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (P)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../../Lims.html" title="Lims (module)">Lims</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Core.html" title="Lims::Core (module)">Core</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Persistence.html" title="Lims::Core::Persistence (module)">Persistence</a></span></span>
     &raquo; 
    <span class="title">Persistor</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Lims::Core::Persistence::Persistor
  <span class="abstract note title">Abstract</span>
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Lims::Core::Persistence::Persistor</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/lims-core/persistence/persistor.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <div class="note abstract">
  <strong>This class is abstract.</strong> 
  <div class='inline'>
<p>Base class for all the persistors, needs to implements a `self.model`</p>
</div>
</div>

<p>returning the class to persist. A persistor , is used to save and load it's
cousin class. The specific code of a persistor should be extended by
writting a persistor class within the class to persist and module
corresponding to the store. The common Persistor architecture would be like
this (let's consider we have a Plate class and a Sequel Persistor). module
SequelPersistor end Class Plate</p>

<pre class="code"><span class='const'>Common</span> <span class='id to'>to</span> <span class='id all'>all</span> <span class='id store'>store</span>
<span class='kw'>class</span> <span class='const'>PlatePersistor</span> <span class='op'>&lt;</span> <span class='const'>Persistence</span><span class='op'>::</span><span class='const'>Persistor</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>PlateSequelPersistor</span> <span class='op'>&lt;</span> <span class='const'>PlatePersistor</span>
  <span class='id include'>include</span> <span class='const'>SequelPersistor</span>
<span class='kw'>end</span></pre>

<p>end if a base persistor exists for a class but not the store specific one
(PlatePersistor exists but PlateSequelPersistor not). If there is a store
pecific Persistor module (like SequelPersistor). The equivalent of
PlateSequelPersistor will be generated on the fly by deriving the base one
and including the mixin. Persistor needs to be registered to be accessible
form the session. However, if NO_AUTO_REGISTRATION is not enabled
persistors will register themselves. In that case, they will need to be
defined in class to persist see <span class='object_link'><a href="#register_model-class_method" title="Lims::Core::Persistence::Persistor.register_model (method)">register_model</a></span>. If a base peristor for
exists for a class but there is no Each instance can get an identity map,
and or parameter specific to a session/thread.</p>
<ul><li>
<p>Methods relative to store  are</p>
</li><li>
<p>insert : a new object to the store</p>
</li><li>
<p>delete : remove an object fromt the store</p>
</li><li>
<p>update : modify an existing object from the store.</p>
</li><li>
<p>retrieve : get an object from the store.</p>
</li><li>
<p>bulk_&lt;method&gt; vs &lt;method&gt; refers to method acting on a list of
states</p>
</li></ul>

<p>instead of an individual object. Althoug only one version needs to be
implemted , the bulk version is prefered for performance reason.</p>
<ul><li>
<p>raw_&lt;method_ refers when exists to the physical action done to the store</p>
</li></ul>

<p>without any side effect on the Session or Persistor. They should not
normally be called.</p>
<ul><li>
<p>Methods relative to parents/children</p>
</li><li>
<p>parents : resources needed to be saved BEFORE the resource itself.</p>
</li><li>
<p>children : resources needed to be save AFTER the resource itself.</p>
</li><li>
<p>deletable_children : resources which needs to be deleted BEFORE the
resource itself.</p>
</li><li>
<p>deletable_parent : resources which needs to be deleted AFTER the resource
itself.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="../../../Array/ArrayLoggerPersistor.html" title="Array::ArrayLoggerPersistor (class)">Array::ArrayLoggerPersistor</a></span>, <span class='object_link'><a href="Search/SearchPersistor.html" title="Lims::Core::Persistence::Search::SearchPersistor (class)">Search::SearchPersistor</a></span>, <span class='object_link'><a href="Sequel/ForTest/Name/NamePersitor.html" title="Lims::Core::Persistence::Sequel::ForTest::Name::NamePersitor (class)">Sequel::ForTest::Name::NamePersitor</a></span>, <span class='object_link'><a href="UuidResource/UuidResourcePersistor.html" title="Lims::Core::Persistence::UuidResource::UuidResourcePersistor (class)">UuidResource::UuidResourcePersistor</a></span>, <span class='object_link'><a href="../../../SessionSpec/Model/ModelPersistor.html" title="SessionSpec::Model::ModelPersistor (class)">SessionSpec::Model::ModelPersistor</a></span></p>
</div>
<h2>Defined Under Namespace</h2>
<p class="children">
   
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Persistor/DuplicateError.html" title="Lims::Core::Persistence::Persistor::DuplicateError (class)">DuplicateError</a></span>, <span class='object_link'><a href="Persistor/DuplicateIdError.html" title="Lims::Core::Persistence::Persistor::DuplicateIdError (class)">DuplicateIdError</a></span>, <span class='object_link'><a href="Persistor/DuplicateObjectError.html" title="Lims::Core::Persistence::Persistor::DuplicateObjectError (class)">DuplicateObjectError</a></span>
    
  
</p>





  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inherited-class_method" title="inherited (class method)">+ (Object) <strong>inherited</strong>(subclass) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Performs an autoregistration if needed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_model-class_method" title="register_model (class method)">+ (Object) <strong>register_model</strong>(subclass) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Register a sub-persistor to the <span class='object_link'><a href="Session.html" title="Lims::Core::Persistence::Session (class)">Session</a></span>.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%5B%5D-instance_method" title="#[] (instance method)">- (Object<sup>?</sup>) <strong>[]</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load a model by different criteria.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bind_state_to_id-instance_method" title="#bind_state_to_id (instance method)">- (Object) <strong>bind_state_to_id</strong>(state) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates the cache so id_to_state reflects state.id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bind_state_to_resource-instance_method" title="#bind_state_to_resource (instance method)">- (Object) <strong>bind_state_to_resource</strong>(state) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update the cache.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bulk_delete-instance_method" title="#bulk_delete (instance method)">- (Object) <strong>bulk_delete</strong>(states, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove object form the underlying store and Manages them.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bulk_delete_raw-instance_method" title="#bulk_delete_raw (instance method)">- (Object) <strong>bulk_delete_raw</strong>(states, *params) </a>
    

    
  </span>
  
  
  
  <span class="abstract note title">Abstract</span>
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Physically remove objects from a store.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bulk_insert-instance_method" title="#bulk_insert (instance method)">- (Object) <strong>bulk_insert</strong>(states, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Inserts objects in the underlying store AND manages them.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bulk_retrieve-instance_method" title="#bulk_retrieve (instance method)">- (Array&lt;Object]) <strong>bulk_retrieve</strong>(ids, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retreives a list of objects .</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bulk_update-instance_method" title="#bulk_update (instance method)">- (Object) <strong>bulk_update</strong>(states, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates the store and manages object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#children-instance_method" title="#children (instance method)">- (Array&lt;Resource&gt;) <strong>children</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of children , i.e, object which need to be saved AFTER it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count-instance_method" title="#count (instance method)">- (Fixnum) <strong>count</strong> </a>
    

    
  </span>
  
  
  
  <span class="abstract note title">Abstract</span>
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the number of object in the store.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deletable_children-instance_method" title="#deletable_children (instance method)">- (Object) <strong>deletable_children</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deletable_parents-instance_method" title="#deletable_parents (instance method)">- (Object) <strong>deletable_parents</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dirty_key_for-instance_method" title="#dirty_key_for (instance method)">- (Object) <strong>dirty_key_for</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Computes "dirty_key" of an object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#for_each_in_slice-instance_method" title="#for_each_in_slice (instance method)">- (Object) <strong>for_each_in_slice</strong>(start, length) {|key, attributes| ... }</a>
    

    
  </span>
  
  
  
  <span class="abstract note title">Abstract</span>
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load a slice.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#id_for-instance_method" title="#id_for (instance method)">- (Id, Nil) <strong>id_for</strong>(object) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the id from an object from the cache.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ids_for-instance_method" title="#ids_for (instance method)">- (Array&lt;Id&gt;) <strong>ids_for</strong>(criteria) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>compute a list of ids matching the criteria.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Persistor) <strong>initialize</strong>(session, *args, &amp;block) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Persistor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#invalid_resource%3F-instance_method" title="#invalid_resource? (instance method)">- (Boolean) <strong>invalid_resource?</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>if a resource is invalid and need to be deleted.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_children-instance_method" title="#load_children (instance method)">- (Object) <strong>load_children</strong>(states, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#model-instance_method" title="#model (instance method)">- (Class) <strong>model</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Associate class (without persistence).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_from_attributes-instance_method" title="#new_from_attributes (instance method)">- (Object) <strong>new_from_attributes</strong>(attributes) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_object-instance_method" title="#new_object (instance method)">- (Resource) <strong>new_object</strong>(id, attributes) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new object from a Hash and associate it to its id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#object_for-instance_method" title="#object_for (instance method)">- (Resourec, Nil) <strong>object_for</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the object from a given id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_object_load-instance_method" title="#on_object_load (instance method)">- (Object) <strong>on_object_load</strong>(state) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Called by Persistor to inform the session about the loading of an object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parents-instance_method" title="#parents (instance method)">- (Array&lt;Resource&gt;) <strong>parents</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of parents of object, i.e.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parents_for_attributes-instance_method" title="#parents_for_attributes (instance method)">- (Object) <strong>parents_for_attributes</strong>(attributes) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#purge_invalid_object-instance_method" title="#purge_invalid_object (instance method)">- (Object) <strong>purge_invalid_object</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Delete all invalid object loaded by a persistor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#retrieve-instance_method" title="#retrieve (instance method)">- (Object<sup>?</sup>) <strong>retrieve</strong>(id, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves an object from it's id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#slice-instance_method" title="#slice (instance method)">- (Enumerable&lt;Hash&gt;) <strong>slice</strong>(start, length) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get a slice of object by offset, length.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#state_for-instance_method" title="#state_for (instance method)">- (ResourceState) <strong>state_for</strong>(object) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the state proxy of an object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#state_for_id-instance_method" title="#state_for_id (instance method)">- (ResourceState) <strong>state_for_id</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the state proxy of an object fromt its id (in cache).</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Lims::Core::Persistence::Persistor (class)">Persistor</a></span></tt>) <strong>initialize</strong>(session, *args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>A new instance of Persistor</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 92</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span> <span class='lparen'>(</span><span class='id session'>session</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='ivar'>@session</span> <span class='op'>=</span> <span class='id session'>session</span>
  <span class='ivar'>@id_to_state</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id h'>h</span><span class='comma'>,</span><span class='id k'>k</span><span class='op'>|</span> <span class='id h'>h</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ResourceState</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id k'>k</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='ivar'>@object_to_state</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id h'>h</span><span class='comma'>,</span><span class='id k'>k</span><span class='op'>|</span> <span class='id h'>h</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ResourceState</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id k'>k</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="inherited-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>inherited</strong>(subclass) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Performs an autoregistration if needed. Autoregistration can be skipped by
defined NO_AUTO_REGISTRATION on the model class. See
Persistor::register_model.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 69</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id inherited'>inherited</span><span class='lparen'>(</span><span class='id subclass'>subclass</span><span class='rparen'>)</span>
  <span class='id register_model'>register_model</span><span class='lparen'>(</span><span class='id subclass'>subclass</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="register_model-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>register_model</strong>(subclass) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Register a sub-persistor to the <span class='object_link'><a href="Session.html" title="Lims::Core::Persistence::Session (class)">Session</a></span>. The name used to register the
persistor would be either the name of the model (parent) class or if
SESSION_NAME is specified on the model : SESSION_NAME</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>subclass</span>
      
      
        <span class='type'>(<tt>Class</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86
87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 78</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id register_model'>register_model</span><span class='lparen'>(</span><span class='id subclass'>subclass</span><span class='rparen'>)</span>
<span class='id model'>model</span> <span class='op'>=</span> <span class='id subclass'>subclass</span><span class='period'>.</span><span class='id parent_scope'>parent_scope</span>
<span class='kw'>return</span> <span class='kw'>if</span> <span class='id model'>model</span><span class='op'>::</span><span class='id const_defined?'>const_defined?</span> <span class='symbol'>:NO_AUTO_REGISTRATION</span>

<span class='id name'>name</span>  <span class='op'>=</span>\
  <span class='kw'>if</span> <span class='id model'>model</span><span class='op'>::</span><span class='id const_defined?'>const_defined?</span> <span class='symbol'>:SESSION_NAME</span> 
    <span class='id model'>model</span><span class='op'>::</span><span class='const'>SESSION_NAME</span>
  <span class='kw'>else</span>
    <span class='id name'>name</span> <span class='op'>=</span> <span class='id model'>model</span><span class='period'>.</span><span class='id name'>name</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>::</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id pop'>pop</span>
  <span class='kw'>end</span>

  <span class='const'>Session</span><span class='op'>::</span><span class='id register_model'>register_model</span><span class='lparen'>(</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id model'>model</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="[]-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt><sup>?</sup>) <strong>[]</strong>(id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Load a model by different criteria. Could be either :</p>
<ul><li>
<p>an Id</p>
</li><li>
<p>a Hash</p>
</li><li>
<p>a list of Ids</p>
</li></ul>

<p>This method will return either a single object or a list of object,
depending of the parameter. Note that loaded object are automatically
<em>added</em> to the session.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the id in the database</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>nil if  object not found.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 114</span>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id id'>id</span>
  <span class='kw'>when</span> <span class='const'>Fixnum</span> <span class='kw'>then</span> <span class='id retrieve'>retrieve</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Hash</span> <span class='kw'>then</span> <span class='id find_by'>find_by</span><span class='lparen'>(</span><span class='id filter_attributes_on_save'>filter_attributes_on_save</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:single</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='const'>Enumerable</span> <span class='kw'>then</span> <span class='id bulk_retrieve'>bulk_retrieve</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="bind_state_to_id-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bind_state_to_id</strong>(state) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Updates the cache so id_to_state reflects state.id</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ResourceState.html" title="Lims::Core::Persistence::ResourceState (class)">ResourceState</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>RuntimeError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 156</span>

<span class='kw'>def</span> <span class='id bind_state_to_id'>bind_state_to_id</span><span class='lparen'>(</span><span class='id state'>state</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Invalid state</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id state'>state</span><span class='period'>.</span><span class='id persistor'>persistor</span> <span class='op'>!=</span> <span class='kw'>self</span>
  <span class='id raise'>raise</span> <span class='const'>DuplicateIdError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id state'>state</span><span class='period'>.</span><span class='id id'>id</span><span class='rparen'>)</span><span class='kw'>if</span> <span class='ivar'>@id_to_state</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='id state'>state</span><span class='period'>.</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='id on_object_load'>on_object_load</span><span class='lparen'>(</span><span class='id state'>state</span><span class='rparen'>)</span>
  <span class='ivar'>@id_to_state</span><span class='lbracket'>[</span><span class='id state'>state</span><span class='period'>.</span><span class='id id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id state'>state</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="bind_state_to_resource-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bind_state_to_resource</strong>(state) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Update the cache</p>


  </div>
</div>
<div class="tags">
  
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>RuntimeError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 172</span>

<span class='kw'>def</span> <span class='id bind_state_to_resource'>bind_state_to_resource</span><span class='lparen'>(</span><span class='id state'>state</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Invalobject state</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id state'>state</span><span class='period'>.</span><span class='id persistor'>persistor</span> <span class='op'>!=</span> <span class='kw'>self</span>
  <span class='id raise'>raise</span> <span class='const'>DuplicateIdError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id state'>state</span><span class='period'>.</span><span class='id resource'>resource</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@object_to_state</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='id state'>state</span><span class='period'>.</span><span class='id resource'>resource</span><span class='rparen'>)</span>
  <span class='ivar'>@object_to_state</span><span class='lbracket'>[</span><span class='id state'>state</span><span class='period'>.</span><span class='id resource'>resource</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id state'>state</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="bulk_delete-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bulk_delete</strong>(states, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Remove object form the underlying store and Manages them. This method only
care about the objects themselves not about theirs parents or children.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


279
280
281
282
283
284
285
286
287</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 279</span>

<span class='kw'>def</span> <span class='id bulk_delete'>bulk_delete</span><span class='lparen'>(</span><span class='id states'>states</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='comment'># delete theme but leave them in cache
</span>  <span class='comment'># in case they need to be displayed.
</span>  <span class='id states'>states</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id state'>state</span><span class='op'>|</span>
    <span class='id state'>state</span><span class='period'>.</span><span class='id id'>id</span><span class='period'>.</span><span class='id andtap'>andtap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id id'>id</span><span class='op'>|</span> <span class='ivar'>@id_to_state</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='id state'>state</span><span class='period'>.</span><span class='id resource'>resource</span> <span class='comment'>#.andtap { |object| @object_to_state.delete(object) }
</span>  <span class='kw'>end</span>
  <span class='id bulk_delete_raw'>bulk_delete_raw</span><span class='lparen'>(</span><span class='id states'>states</span><span class='period'>.</span><span class='id map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id compact'>compact</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="bulk_delete_raw-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bulk_delete_raw</strong>(states, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <div class="note abstract">
  <strong>This method is abstract.</strong> 
  <div class='inline'></div>
</div>

<p>Physically remove objects from a store.</p>


  </div>
</div>
<div class="tags">
  
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


291
292
293</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 291</span>

<span class='kw'>def</span> <span class='id bulk_delete_raw'>bulk_delete_raw</span><span class='lparen'>(</span><span class='id states'>states</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="bulk_insert-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bulk_insert</strong>(states, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Inserts objects in the underlying store AND manages them. This method only
care about the objects themselves not about theirs parents or children. The
physical insert in the store must be  specified for each store.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


272
273
274</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 272</span>

<span class='kw'>def</span> <span class='id bulk_insert'>bulk_insert</span><span class='lparen'>(</span><span class='id states'>states</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id states'>states</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id state'>state</span><span class='op'>|</span> <span class='id insert'>insert</span><span class='lparen'>(</span><span class='id state'>state</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="bulk_retrieve-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span>]</tt>) <strong>bulk_retrieve</strong>(ids, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Retreives a list of objects . @<a href="http://Array<Id>">param</a> ids</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span>]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array&lt;Object]</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 324</span>

<span class='kw'>def</span> <span class='id bulk_retrieve'>bulk_retrieve</span><span class='lparen'>(</span><span class='id ids'>ids</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='comment'># create a list of states and load them
</span>  <span class='id states'>states</span> <span class='op'>=</span> <span class='const'>StateGroup</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id ids'>ids</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id id'>id</span><span class='op'>|</span>
    <span class='ivar'>@id_to_state</span><span class='lbracket'>[</span><span class='id id'>id</span><span class='rbracket'>]</span>
  <span class='kw'>end</span><span class='rparen'>)</span>

  <span class='id states'>states</span><span class='period'>.</span><span class='id load'>load</span>
  <span class='kw'>return</span> <span class='const'>StateList</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id states'>states</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id state'>state</span><span class='op'>|</span> <span class='id state'>state</span><span class='period'>.</span><span class='id resource'>resource</span> <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='comment'># we need to separate object which need to be loaded
</span>  <span class='comment'># from the one which are already in cache
</span>  <span class='id to_load'>to_load</span> <span class='op'>=</span> <span class='id ids'>ids</span><span class='period'>.</span><span class='id reject'>reject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id id'>id</span><span class='op'>|</span> <span class='id id'>id</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='ivar'>@id_to_state</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id loaded_states'>loaded_states</span> <span class='op'>=</span> <span class='id bulk_load_raw_attributes'>bulk_load_raw_attributes</span><span class='lparen'>(</span><span class='id to_load'>to_load</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id att'>att</span><span class='op'>|</span>
    <span class='id id'>id</span> <span class='op'>=</span> <span class='id att'>att</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='id primary_key'>primary_key</span><span class='rparen'>)</span>
    <span class='id new_state_for_attribute'>new_state_for_attribute</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id att'>att</span><span class='rparen'>)</span><span class='period'>.</span><span class='id resource'>resource</span>
  <span class='kw'>end</span>

  <span class='id bulk_retrieve_children'>bulk_retrieve_children</span><span class='lparen'>(</span><span class='id new_states'>new_states</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='comment'>#bulk_retrieve_parent(new_states, *params)
</span>

  <span class='id ids'>ids</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id id'>id</span><span class='op'>|</span> <span class='id object_for'>object_for</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="bulk_update-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bulk_update</strong>(states, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Updates the store and manages object. Doesn't care of children or parents.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>Array&lt;ResourceState]</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="ResourceState.html" title="Lims::Core::Persistence::ResourceState (class)">ResourceState</a></span>] states</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>states</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


351
352
353
354
355
356
357
358
359</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 351</span>

<span class='kw'>def</span> <span class='id bulk_update'>bulk_update</span><span class='lparen'>(</span><span class='id states'>states</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id attributes'>attributes</span> <span class='op'>=</span> <span class='id states'>states</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id state'>state</span><span class='op'>|</span>
    <span class='id filter_attributes_on_save'>filter_attributes_on_save</span><span class='lparen'>(</span><span class='id state'>state</span><span class='period'>.</span><span class='id resource'>resource</span><span class='period'>.</span><span class='id attributes'>attributes</span><span class='rparen'>)</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id primary_key'>primary_key</span> <span class='op'>=&gt;</span> <span class='id state'>state</span><span class='period'>.</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id bulk_update_raw_attributes'>bulk_update_raw_attributes</span><span class='lparen'>(</span><span class='id attributes'>attributes</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id states'>states</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id state'>state</span><span class='op'>|</span>
    <span class='id state'>state</span><span class='period'>.</span><span class='id updated'>updated</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="children-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span>&gt;</tt>) <strong>children</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>List of children , i.e, object which need to be saved AFTER it.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>resource</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


381
382
383</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 381</span>

<span class='kw'>def</span> <span class='id children'>children</span><span class='lparen'>(</span><span class='id resource'>resource</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="count-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>count</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <div class="note abstract">
  <strong>This method is abstract.</strong> 
  <div class='inline'></div>
</div>

<p>Returns the number of object in the store</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 240</span>

<span class='kw'>def</span> <span class='id count'>count</span>
  <span class='id raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="deletable_children-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>deletable_children</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong> 
    <div class='inline'></div>
  </div>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


386
387
388</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 386</span>

<span class='kw'>def</span> <span class='id deletable_children'>deletable_children</span><span class='lparen'>(</span><span class='id resource'>resource</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="deletable_parents-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>deletable_parents</strong>(resource) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


390
391
392</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 390</span>

<span class='kw'>def</span> <span class='id deletable_parents'>deletable_parents</span><span class='lparen'>(</span><span class='id resource'>resource</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="dirty_key_for-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>dirty_key_for</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Computes "dirty_key" of an object. The dirty key is used to decide if an
object has been modified or not.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


195
196
197
198
199</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 195</span>

<span class='kw'>def</span> <span class='id dirty_key_for'>dirty_key_for</span><span class='lparen'>(</span><span class='id resource'>resource</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id resource'>resource</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@session</span><span class='period'>.</span><span class='id dirty_attribute_strategy'>dirty_attribute_strategy</span>
      <span class='ivar'>@session</span><span class='period'>.</span><span class='id dirty_key_for'>dirty_key_for</span><span class='lparen'>(</span><span class='id filter_attributes_on_save'>filter_attributes_on_save</span><span class='lparen'>(</span><span class='id resource'>resource</span><span class='period'>.</span><span class='id attributes_for_dirty'>attributes_for_dirty</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="for_each_in_slice-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>for_each_in_slice</strong>(start, length) {|key, attributes| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <div class="note abstract">
  <strong>This method is abstract.</strong> 
  <div class='inline'></div>
</div>

<p>Load a slice. Doesn't return an object but a hash allowing to build it.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>start</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>(0 based)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>length</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Yield Parameters:</h3>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>attributes</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>of the object</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 251</span>

<span class='kw'>def</span> <span class='id for_each_in_slice'>for_each_in_slice</span><span class='lparen'>(</span><span class='id start'>start</span><span class='comma'>,</span> <span class='id length'>length</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="id_for-instance_method">
  
    - (<tt>Id</tt>, <tt>Nil</tt>) <strong>id_for</strong>(object) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Get the id from an object from the cache.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>object</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>object to find the id for.</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Id</tt>, <tt>Nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 125</span>

<span class='kw'>def</span> <span class='id id_for'>id_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='rparen'>)</span>
  <span class='id state_for'>state_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='rparen'>)</span><span class='period'>.</span><span class='id andtap'>andtap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id state'>state</span><span class='op'>|</span> <span class='id state'>state</span><span class='period'>.</span><span class='id id'>id</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ids_for-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;Id&gt;</tt>) <strong>ids_for</strong>(criteria) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>compute a list of ids matching the criteria</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>criteria</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>list of attribute/value pais</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;Id&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


233
234
235</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 233</span>

<span class='kw'>def</span> <span class='id ids_for'>ids_for</span><span class='lparen'>(</span><span class='id criteria'>criteria</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="invalid_resource?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>invalid_resource?</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>if a resource is invalid and need to be deleted. For example an association
proxy corresponding to an old relation.</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


397
398
399</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 397</span>

<span class='kw'>def</span> <span class='id invalid_resource?'>invalid_resource?</span><span class='lparen'>(</span><span class='id resource'>resource</span><span class='rparen'>)</span>
  <span class='id resource'>resource</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:invalid?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id resource'>resource</span><span class='period'>.</span><span class='id invalid?'>invalid?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="load_children-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>load_children</strong>(states, *params) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


430
431
432</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 430</span>

<span class='kw'>def</span> <span class='id load_children'>load_children</span><span class='lparen'>(</span><span class='id states'>states</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="model-instance_method">
  
    - (<tt>Class</tt>) <strong>model</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Associate class (without persistence).</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Class</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 101</span>

<span class='kw'>def</span> <span class='id model'>model</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='op'>::</span><span class='const'>Model</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="new_from_attributes-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>new_from_attributes</strong>(attributes) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


435
436
437
438
439</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 435</span>

<span class='kw'>def</span> <span class='id new_from_attributes'>new_from_attributes</span><span class='lparen'>(</span><span class='id attributes'>attributes</span><span class='rparen'>)</span>
  <span class='id id'>id</span> <span class='op'>=</span> <span class='id attributes'>attributes</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='id primary_key'>primary_key</span><span class='rparen'>)</span>
  <span class='id resource'>resource</span> <span class='op'>=</span> <span class='id block_given?'>block_given?</span> <span class='op'>?</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id attributes'>attributes</span><span class='rparen'>)</span> <span class='op'>:</span>   <span class='id model'>model</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id filter_attributes_on_load'>filter_attributes_on_load</span><span class='lparen'>(</span><span class='id attributes'>attributes</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id state_for_id'>state_for_id</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id tap'>tap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id state'>state</span><span class='op'>|</span> <span class='id state'>state</span><span class='period'>.</span><span class='id resource'>resource</span> <span class='op'>=</span> <span class='id resource'>resource</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="new_object-instance_method">
  
    - (<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>) <strong>new_object</strong>(id, attributes) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Creates a new object from a Hash and associate it to its id</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Id</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>id of the new object</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attributes</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>of the new object.</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 182</span>

<span class='kw'>def</span> <span class='id new_object'>new_object</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id attributes'>attributes</span><span class='rparen'>)</span>
  <span class='id id'>id</span> <span class='op'>=</span> <span class='id attributes'>attributes</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='id primary_key'>primary_key</span><span class='rparen'>)</span>
  <span class='id model'>model</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id filter_attributes_on_load'>filter_attributes_on_load</span><span class='lparen'>(</span><span class='id attributes'>attributes</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id resource'>resource</span><span class='op'>|</span>
    <span class='id state'>state</span> <span class='op'>=</span> <span class='id state_for_id'>state_for_id</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
    <span class='id state'>state</span><span class='period'>.</span><span class='id resource'>resource</span> <span class='op'>=</span> <span class='id resource'>resource</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="object_for-instance_method">
  
    - (<tt>Resourec</tt>, <tt>Nil</tt>) <strong>object_for</strong>(id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Get the object from a given id.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Resourec</tt>, <tt>Nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 132</span>

<span class='kw'>def</span> <span class='id object_for'>object_for</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='ivar'>@id_to_state</span><span class='lbracket'>[</span><span class='id id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id andtap'>andtap</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:resource</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_object_load-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>on_object_load</strong>(state) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Called by Persistor to inform the session about the loading of an object.
MUST be called by persistors creating Resources.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ResourceState.html" title="Lims::Core::Persistence::ResourceState (class)">ResourceState</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 167</span>

<span class='kw'>def</span> <span class='id on_object_load'>on_object_load</span><span class='lparen'>(</span><span class='id state'>state</span><span class='rparen'>)</span>
  <span class='ivar'>@session</span><span class='period'>.</span><span class='id manage_state'>manage_state</span><span class='lparen'>(</span><span class='id state'>state</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="parents-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span>&gt;</tt>) <strong>parents</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>List of parents of object, i.e. object which need to be saved BEFORE it.
Default implementation get all Resource attributes.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>resource</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


374
375
376</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 374</span>

<span class='kw'>def</span> <span class='id parents'>parents</span><span class='lparen'>(</span><span class='id resource'>resource</span><span class='rparen'>)</span>
  <span class='id resource'>resource</span><span class='period'>.</span><span class='id attributes'>attributes</span><span class='period'>.</span><span class='id values'>values</span><span class='period'>.</span><span class='id select'>select</span>  <span class='lbrace'>{</span> <span class='op'>|</span><span class='id v'>v</span><span class='op'>|</span> <span class='id v'>v</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>Resource</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="parents_for_attributes-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>parents_for_attributes</strong>(attributes) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


425
426
427</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 425</span>

<span class='kw'>def</span> <span class='id parents_for_attributes'>parents_for_attributes</span><span class='lparen'>(</span><span class='id attributes'>attributes</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="purge_invalid_object-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>purge_invalid_object</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Delete all invalid object loaded by a persistor. Typically invalid object
are association which doesn't exist anymore</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205
206
207
208
209
210</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 203</span>

<span class='kw'>def</span> <span class='id purge_invalid_object'>purge_invalid_object</span>
  <span class='id to_delete'>to_delete</span> <span class='op'>=</span> <span class='const'>StateGroup</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@object_to_state</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id object'>object</span><span class='comma'>,</span> <span class='id state'>state</span><span class='op'>|</span>
    <span class='id to_delete'>to_delete</span> <span class='op'>&lt;&lt;</span> <span class='id state'>state</span> <span class='kw'>if</span>  <span class='id invalid_resource?'>invalid_resource?</span><span class='lparen'>(</span><span class='id object'>object</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id to_delete'>to_delete</span><span class='period'>.</span><span class='id destroy'>destroy</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="retrieve-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt><sup>?</sup>) <strong>retrieve</strong>(id, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Retrieves an object from it's id. Doesn't load it if it's been alreday
loaded.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Id</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


314
315
316
317
318
319</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 314</span>

<span class='kw'>def</span> <span class='id retrieve'>retrieve</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id object_for'>object_for</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id andtap'>andtap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id o'>o</span><span class='op'>|</span> <span class='kw'>return</span> <span class='id o'>o</span> <span class='rbrace'>}</span>
  <span class='id objects'>objects</span> <span class='op'>=</span> <span class='id bulk_retrieve'>bulk_retrieve</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id id'>id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id objects'>objects</span><span class='period'>.</span><span class='id first'>first</span> <span class='kw'>if</span> <span class='id objects'>objects</span> <span class='op'>&amp;&amp;</span> <span class='id objects'>objects</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>==</span> <span class='int'>1</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="slice-instance_method">
  
    - (<tt>Enumerable&lt;Hash&gt;</tt>) <strong>slice</strong>(start, length) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Get a slice of object by offset, length. <tt>start</tt> here is an offset
(starting at 0) not an Id.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>start</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>(0 based)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>length</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Enumerable&lt;Hash&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 260</span>

<span class='kw'>def</span> <span class='id slice'>slice</span><span class='lparen'>(</span><span class='id start'>start</span><span class='comma'>,</span> <span class='id length'>length</span><span class='rparen'>)</span>
  <span class='id to_load'>to_load</span> <span class='op'>=</span> <span class='const'>StateGroup</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id for_each_in_slice'>for_each_in_slice</span><span class='lparen'>(</span><span class='id start'>start</span><span class='comma'>,</span> <span class='id length'>length</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id att'>att</span><span class='op'>|</span>
      <span class='id to_load'>to_load</span> <span class='op'>&lt;&lt;</span> <span class='id new_from_attributes'>new_from_attributes</span><span class='lparen'>(</span><span class='id att'>att</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='id to_load'>to_load</span><span class='period'>.</span><span class='id load'>load</span><span class='period'>.</span><span class='id map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:resource</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="state_for-instance_method">
  
    - (<tt><span class='object_link'><a href="ResourceState.html" title="Lims::Core::Persistence::ResourceState (class)">ResourceState</a></span></tt>) <strong>state_for</strong>(object) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Returns the state proxy of an object. Creates it if needed.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>object</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ResourceState.html" title="Lims::Core::Persistence::ResourceState (class)">ResourceState</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 141</span>

<span class='kw'>def</span> <span class='id state_for'>state_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='rparen'>)</span>
  <span class='ivar'>@object_to_state</span><span class='lbracket'>[</span><span class='id object'>object</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="state_for_id-instance_method">
  
    - (<tt><span class='object_link'><a href="ResourceState.html" title="Lims::Core::Persistence::ResourceState (class)">ResourceState</a></span></tt>) <strong>state_for_id</strong>(id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Returns the state proxy of an object fromt its id (in cache). Creates the
state if needed.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>object</span>
      
      
        <span class='type'>(<tt>Id</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ResourceState.html" title="Lims::Core::Persistence::ResourceState (class)">ResourceState</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


149
150
151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 149</span>

<span class='kw'>def</span> <span class='id state_for_id'>state_for_id</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
    <span class='ivar'>@id_to_state</span><span class='lbracket'>[</span><span class='id id'>id</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    
  </body>
</html>