<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Lims::Core::Persistence::Persistor
  
    &mdash; Documentation by YARD 0.7.3
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (P)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../../Lims.html" title="Lims (module)">Lims</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Core.html" title="Lims::Core (module)">Core</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Persistence.html" title="Lims::Core::Persistence (module)">Persistence</a></span></span>
     &raquo; 
    <span class="title">Persistor</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Lims::Core::Persistence::Persistor
  <span class="abstract note title">Abstract</span>
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Lims::Core::Persistence::Persistor</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="IdentityMap.html" title="Lims::Core::Persistence::IdentityMap (module)">IdentityMap</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/lims-core/persistence/persistor.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <div class="note abstract">
  <strong>This class is abstract.</strong> 
  <div class='inline'>
<p>Base class for all the persistors, needs to implements a `self.model`</p>
</div>
</div>

<p>returning the class to persist. A persistor , is used to save and load it's
cousin class. The specific code of a persistor should be extended by
writting a persistor class within the class to persist and module
corresponding to the store. The common Persistor architecture would be like
this (let's consider we have a Plate class and a Sequel Persistor). module
SequelPersistor end Class Plate</p>

<pre class="code"><span class='const'>Common</span> <span class='id to'>to</span> <span class='id all'>all</span> <span class='id store'>store</span>
<span class='kw'>class</span> <span class='const'>PlatePersistor</span> <span class='op'>&lt;</span> <span class='const'>Persistence</span><span class='op'>::</span><span class='const'>Persistor</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>PlateSequelPersistor</span> <span class='op'>&lt;</span> <span class='const'>PlatePersistor</span>
  <span class='id include'>include</span> <span class='const'>SequelPersistor</span>
<span class='kw'>end</span></pre>

<p>end if a base persistor exists for a class but not the store specific one
(PlatePersistor exists but PlateSequelPersistor not). If there is a store
pecific Persistor module (like SequelPersistor). The equivalent of
PlateSequelPersistor will be generated on the fly by deriving the base one
and including the mixin. Persistor needs to be registered to be accessible
form the session. However, if NO_AUTO_REGISTRATION is not enabled
persistors will register themselves. In that case, they will need to be
defined in class to persist see <span class='object_link'><a href="#register_model-class_method" title="Lims::Core::Persistence::Persistor.register_model (method)">register_model</a></span>. If a base peristor for
exists for a class but there is no Each instance can get an identity map,
and or parameter specific to a session/thread.</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="../../../Array/ArrayLoggerPersistor.html" title="Array::ArrayLoggerPersistor (class)">Array::ArrayLoggerPersistor</a></span>, <span class='object_link'><a href="Search/SearchPersistor.html" title="Lims::Core::Persistence::Search::SearchPersistor (class)">Search::SearchPersistor</a></span>, <span class='object_link'><a href="UuidResource/UuidResourcePersistor.html" title="Lims::Core::Persistence::UuidResource::UuidResourcePersistor (class)">UuidResource::UuidResourcePersistor</a></span>, <span class='object_link'><a href="../../../SessionSpec/Model/ModelPersistor.html" title="SessionSpec::Model::ModelPersistor (class)">SessionSpec::Model::ModelPersistor</a></span></p>
</div>


  
  
  
  


  
  
  

  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inherited-class_method" title="inherited (class method)">+ (Object) <strong>inherited</strong>(subclass) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Performs an autoregistration if needed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_model-class_method" title="register_model (class method)">+ (Object) <strong>register_model</strong>(subclass) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Register a sub-persistor to the <span class='object_link'><a href="Session.html" title="Lims::Core::Persistence::Session (class)">Session</a></span>.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%5B%5D-instance_method" title="#[] (instance method)">- (Object<sup>?</sup>) <strong>[]</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load a model by different criteria.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count-instance_method" title="#count (instance method)">- (Fixnum) <strong>count</strong> </a>
    

    
  </span>
  
  
  
  <span class="abstract note title">Abstract</span>
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the number of object in the store.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete-instance_method" title="#delete (instance method)">- (Fixnum<sup>?</sup>) <strong>delete</strong>(object, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>deletes an object and returns its id or nil if failure.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#for_each_in_slice-instance_method" title="#for_each_in_slice (instance method)">- (Object) <strong>for_each_in_slice</strong>(start, length) {|key, attributes| ... }</a>
    

    
  </span>
  
  
  
  <span class="abstract note title">Abstract</span>
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load a slice.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ids_for-instance_method" title="#ids_for (instance method)">- (Array&lt;Id&gt;) <strong>ids_for</strong>(criteria) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>compute a list of ids matching the criteria.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Persistor) <strong>initialize</strong>(session, *args, &amp;block) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Persistor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_aggregated_elements-instance_method" title="#load_aggregated_elements (instance method)">- (Object) <strong>load_aggregated_elements</strong>(id, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_associated_elements-instance_method" title="#load_associated_elements (instance method)">- (Object) <strong>load_associated_elements</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#load_single_model-instance_method" title="#load_single_model (instance method)">- (Resource) <strong>load_single_model</strong>(id, raw_attributes = nil) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load a model object (and its children) from its database id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#model-instance_method" title="#model (instance method)">- (Class) <strong>model</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Associate class (without persistence).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save-instance_method" title="#save (instance method)">- (Fixnum<sup>?</sup>) <strong>save</strong>(object, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>save an object and return is id or nil if failure.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_as_aggregation-instance_method" title="#save_as_aggregation (instance method)">- (Object) <strong>save_as_aggregation</strong>(source_id, target, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>save an aggregation Aggregation doesn't have necessarily and id therefore
we don't use the indentity map.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_as_association-instance_method" title="#save_as_association (instance method)">- (Object) <strong>save_as_association</strong>(source, target, *params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>save an association Association doesn't have necessarily and id therefore
we don't use the indentity map.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#slice-instance_method" title="#slice (instance method)">- (Enumerable&lt;Hash&gt;) <strong>slice</strong>(start, length) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get a slice of object by offset, length.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="IdentityMap.html" title="Lims::Core::Persistence::IdentityMap (module)">IdentityMap</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="IdentityMap.html#id_for-instance_method" title="Lims::Core::Persistence::IdentityMap#id_for (method)">#id_for</a></span>, <span class='object_link'><a href="IdentityMap.html#map_id_object-instance_method" title="Lims::Core::Persistence::IdentityMap#map_id_object (method)">#map_id_object</a></span>, <span class='object_link'><a href="IdentityMap.html#object_for-instance_method" title="Lims::Core::Persistence::IdentityMap#object_for (method)">#object_for</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Lims::Core::Persistence::Persistor (class)">Persistor</a></span></tt>) <strong>initialize</strong>(session, *args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>A new instance of Persistor</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 65</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span> <span class='lparen'>(</span><span class='id session'>session</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='ivar'>@session</span> <span class='op'>=</span> <span class='id session'>session</span>
  <span class='ivar'>@id_to_dirty_key</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="inherited-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>inherited</strong>(subclass) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Performs an autoregistration if needed. Autoregistration can be skipped by
defined NO_AUTO_REGISTRATION on the model class. See
Persistor::register_model.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 42</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id inherited'>inherited</span><span class='lparen'>(</span><span class='id subclass'>subclass</span><span class='rparen'>)</span>
  <span class='id register_model'>register_model</span><span class='lparen'>(</span><span class='id subclass'>subclass</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="register_model-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>register_model</strong>(subclass) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Register a sub-persistor to the <span class='object_link'><a href="Session.html" title="Lims::Core::Persistence::Session (class)">Session</a></span>. The name used to register the
persistor would be either the name of the model (parent) class or if
SESSION_NAME is specified on the model : SESSION_NAME</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>subclass</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="IdentityMap/Class.html" title="Lims::Core::Persistence::IdentityMap::Class (class)">Class</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53
54
55
56
57
58
59
60
61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 51</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id register_model'>register_model</span><span class='lparen'>(</span><span class='id subclass'>subclass</span><span class='rparen'>)</span>
<span class='id model'>model</span> <span class='op'>=</span> <span class='id subclass'>subclass</span><span class='period'>.</span><span class='id parent_scope'>parent_scope</span>
<span class='kw'>return</span> <span class='kw'>if</span> <span class='id model'>model</span><span class='op'>::</span><span class='id const_defined?'>const_defined?</span> <span class='symbol'>:NO_AUTO_REGISTRATION</span>

<span class='id name'>name</span>  <span class='op'>=</span>\
  <span class='kw'>if</span> <span class='id model'>model</span><span class='op'>::</span><span class='id const_defined?'>const_defined?</span> <span class='symbol'>:SESSION_NAME</span> 
    <span class='id model'>model</span><span class='op'>::</span><span class='const'>SESSION_NAME</span>
  <span class='kw'>else</span>
    <span class='id name'>name</span> <span class='op'>=</span> <span class='id model'>model</span><span class='period'>.</span><span class='id name'>name</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>::</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id pop'>pop</span>
  <span class='kw'>end</span>

  <span class='const'>Session</span><span class='op'>::</span><span class='id register_model'>register_model</span><span class='lparen'>(</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id model'>model</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="[]-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt><sup>?</sup>) <strong>[]</strong>(id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Load a model by different criteria. Could be either :</p>
<ul><li>
<p>an Id</p>
</li><li>
<p>a Hash</p>
</li><li>
<p>a list of Ids</p>
</li></ul>

<p>This method will return either a single object or a list of object,
depending of the parameter. Note that loaded object are automatically
<em>added</em> to the session.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the id in the database</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>nil if  object not found.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


86
87
88
89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 86</span>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id id'>id</span>
  <span class='kw'>when</span> <span class='const'>Fixnum</span> <span class='kw'>then</span> <span class='id get_or_create_single_model'>get_or_create_single_model</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Hash</span> <span class='kw'>then</span> <span class='id find_by'>find_by</span><span class='lparen'>(</span><span class='id filter_attributes_on_save'>filter_attributes_on_save</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:single</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="count-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>count</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <div class="note abstract">
  <strong>This method is abstract.</strong> 
  <div class='inline'></div>
</div>

<p>Returns the number of object in the store</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 215</span>

<span class='kw'>def</span> <span class='id count'>count</span>
  <span class='id raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="delete-instance_method">
  
    - (<tt>Fixnum</tt><sup>?</sup>) <strong>delete</strong>(object, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>deletes an object and returns its id or nil if failure</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110
111
112</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 104</span>

<span class='kw'>def</span> <span class='id delete'>delete</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id object'>object</span><span class='period'>.</span><span class='id nil?'>nil?</span>
  <span class='id id_for'>id_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id id'>id</span><span class='op'>|</span>
    <span class='comment'># We need to delet the children before the parent
</span>    <span class='comment'># to not break any constraints
</span>    <span class='id delete_children'>delete_children</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id object'>object</span><span class='rparen'>)</span>
    <span class='id delete_raw'>delete_raw</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='id id'>id</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="for_each_in_slice-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>for_each_in_slice</strong>(start, length) {|key, attributes| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <div class="note abstract">
  <strong>This method is abstract.</strong> 
  <div class='inline'></div>
</div>

<p>Load a slice. Doesn't return an object but a hash allowing to build it.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>start</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>(0 based)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>length</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Yield Parameters:</h3>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>attributes</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>of the object</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 226</span>

<span class='kw'>def</span> <span class='id for_each_in_slice'>for_each_in_slice</span><span class='lparen'>(</span><span class='id start'>start</span><span class='comma'>,</span> <span class='id length'>length</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ids_for-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;Id&gt;</tt>) <strong>ids_for</strong>(criteria) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>compute a list of ids matching the criteria</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>criteria</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>list of attribute/value pais</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;Id&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 199</span>

<span class='kw'>def</span> <span class='id ids_for'>ids_for</span><span class='lparen'>(</span><span class='id criteria'>criteria</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="load_aggregated_elements-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>load_aggregated_elements</strong>(id, &amp;block) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


207
208
209
210</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 207</span>

<span class='kw'>def</span> <span class='id load_aggregated_elements'>load_aggregated_elements</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id load_raw_associations'>load_raw_associations</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id element_id'>element_id</span><span class='op'>|</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="load_associated_elements-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>load_associated_elements</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 204</span>

<span class='kw'>def</span> <span class='id load_associated_elements'>load_associated_elements</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="load_single_model-instance_method">
  
    - (<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>) <strong>load_single_model</strong>(id, raw_attributes = nil)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Load a model object (and its children) from its database id.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Id</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>in the database</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>raw_attributes</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>attributes to build the object</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the model object.</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>error if object doesn't exists.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 143</span>

<span class='kw'>def</span> <span class='id load_single_model'>load_single_model</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id raw_attributes'>raw_attributes</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id raw_attributes'>raw_attributes</span> <span class='op'>||=</span> <span class='id load_raw_attributes'>load_raw_attributes</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='id model'>model</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id filter_attributes_on_load'>filter_attributes_on_load</span><span class='lparen'>(</span><span class='id raw_attributes'>raw_attributes</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id m'>m</span><span class='op'>|</span>
    <span class='id load_children'>load_children</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id m'>m</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="model-instance_method">
  
    - (<tt><span class='object_link'><a href="IdentityMap/Class.html" title="Lims::Core::Persistence::IdentityMap::Class (class)">Class</a></span></tt>) <strong>model</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Associate class (without persistence).</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="IdentityMap/Class.html" title="Lims::Core::Persistence::IdentityMap::Class (class)">Class</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 73</span>

<span class='kw'>def</span> <span class='id model'>model</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='op'>::</span><span class='const'>Model</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="save-instance_method">
  
    - (<tt>Fixnum</tt><sup>?</sup>) <strong>save</strong>(object, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>save an object and return is id or nil if failure</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97
98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 95</span>

<span class='kw'>def</span> <span class='id save'>save</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id object'>object</span><span class='period'>.</span><span class='id nil?'>nil?</span>
  <span class='comment'># check if the object has been modified or not
</span>  <span class='id id_for'>id_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id id'>id</span><span class='op'>|</span> <span class='id update'>update</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='id id'>id</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='op'>||</span>
  <span class='id map_id_object'>map_id_object</span><span class='lparen'>(</span><span class='id save_new'>save_new</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span> <span class='comma'>,</span> <span class='id object'>object</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="save_as_aggregation-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>save_as_aggregation</strong>(source_id, target, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>save an aggregation Aggregation doesn't have necessarily and id therefore
we don't use the indentity map. Save objects if needed. Aggregation differs
from association in the fact that the 'parent' is already saved and the
children have to be saved.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>source_id</span>
      
      
        <span class='type'>(<tt>id</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>target</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>will be saved.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>specific to the Store.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 134</span>

<span class='kw'>def</span> <span class='id save_as_aggregation'>save_as_aggregation</span><span class='lparen'>(</span><span class='id source_id'>source_id</span><span class='comma'>,</span> <span class='id target'>target</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id save_raw_association'>save_raw_association</span><span class='lparen'>(</span><span class='id source_id'>source_id</span><span class='comma'>,</span> <span class='ivar'>@session</span><span class='period'>.</span><span class='id save'>save</span><span class='lparen'>(</span><span class='id target'>target</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="save_as_association-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>save_as_association</strong>(source, target, *params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>save an association Association doesn't have necessarily and id therefore
we don't use the indentity map. Save objects if needed.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>source</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>, <tt>Id</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the source of the association.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>target</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="Lims::Core::Resource (module)">Resource</a></span></tt>, <tt>Id</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the target of the association.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>specific to the Store.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 120</span>

<span class='kw'>def</span> <span class='id save_as_association'>save_as_association</span><span class='lparen'>(</span><span class='id source'>source</span><span class='comma'>,</span> <span class='id target'>target</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id save_raw_association'>save_raw_association</span><span class='lparen'>(</span><span class='ivar'>@session</span><span class='period'>.</span><span class='id id_for!'>id_for!</span><span class='lparen'>(</span><span class='id source'>source</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='ivar'>@session</span><span class='period'>.</span><span class='id id_for!'>id_for!</span><span class='lparen'>(</span><span class='id target'>target</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='op'>*</span><span class='id params'>params</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="slice-instance_method">
  
    - (<tt>Enumerable&lt;Hash&gt;</tt>) <strong>slice</strong>(start, length) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Get a slice of object by offset, length. <tt>start</tt> here is an offset
(starting at 0) not an Id.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>start</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>(0 based)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>length</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Enumerable&lt;Hash&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


235
236
237
238
239
240
241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/persistence/persistor.rb', line 235</span>

<span class='kw'>def</span> <span class='id slice'>slice</span><span class='lparen'>(</span><span class='id start'>start</span><span class='comma'>,</span> <span class='id length'>length</span><span class='rparen'>)</span>
  <span class='const'>Enumerator</span><span class='period'>.</span><span class='id new'>new</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id yielder'>yielder</span><span class='op'>|</span>
    <span class='id for_each_in_slice'>for_each_in_slice</span><span class='lparen'>(</span><span class='id start'>start</span><span class='comma'>,</span> <span class='id length'>length</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id att'>att</span><span class='op'>|</span>
      <span class='id yielder'>yielder</span> <span class='op'>&lt;&lt;</span> <span class='id get_or_create_single_model'>get_or_create_single_model</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id att'>att</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    
  </body>
</html>