<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Lims::Core::Actions::Action::AfterEval
  
    &mdash; Documentation by YARD 0.7.3
  
</title>

  <link rel="stylesheet" href="../../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../../_index.html">Index (A)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../../../Lims.html" title="Lims (module)">Lims</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../../Core.html" title="Lims::Core (module)">Core</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Actions.html" title="Lims::Core::Actions (module)">Actions</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Action.html" title="Lims::Core::Actions::Action (module)">Action</a></span></span>
     &raquo; 
    <span class="title">AfterEval</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Lims::Core::Actions::Action::AfterEval
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/lims-core/actions/action.rb</dd>
  
</dl>
<div class="clear"></div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_call_in_session-instance_method" title="#_call_in_session (instance method)">- (Object) <strong>_call_in_session</strong>(session) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This is the main method of an action, called to effectively perform an
action.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_objects_to_save-instance_method" title="#_objects_to_save (instance method)">- (Object) <strong>_objects_to_save</strong> </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>List of objects to save (add to the session).</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_revert_in_session-instance_method" title="#_revert_in_session (instance method)">- (Object) <strong>_revert_in_session</strong>(session) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>how to revert the action, if possible.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#call-instance_method" title="#call (instance method)">- (Object) <strong>call</strong> {|a, session| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Executes the action.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (AfterEval) <strong>initialize</strong>(*args, &amp;initializer) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initialize a new actions 'Common' parameters are set as argument whereas
specific ones are set on a dummy object via the block.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#revert-instance_method" title="#revert (instance method)">- (Object) <strong>revert</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute the opposite of the action if possible.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_session-instance_method" title="#with_session (instance method)">- (Object, False) <strong>with_session</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute the given block within a new session.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="_call_in_session-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>_call_in_session</strong>(session)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>This is the main method of an action, called to effectively perform an
action.</p>


  </div>
</div>
<div class="tags">
  
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/actions/action.rb', line 127</span>

<span class='kw'>def</span> <span class='id _call_in_session'>_call_in_session</span><span class='lparen'>(</span><span class='id session'>session</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="_objects_to_save-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>_objects_to_save</strong>  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>List of objects to save (add to the session). By default get all attributes
and the resulth. Override if need (to add a created resource for example).</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>a list of object to save</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/actions/action.rb', line 141</span>

<span class='kw'>def</span> <span class='id _objects_to_save'>_objects_to_save</span>
  <span class='lbracket'>[</span><span class='id result'>result</span><span class='comma'>,</span> <span class='op'>*</span><span class='id attributes'>attributes</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id a'>a</span><span class='op'>|</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id o'>o</span><span class='op'>|</span> <span class='id o'>o</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Resource</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="_revert_in_session-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>_revert_in_session</strong>(session)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>how to revert the action, if possible.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/actions/action.rb', line 133</span>

<span class='kw'>def</span> <span class='id _revert_in_session'>_revert_in_session</span><span class='lparen'>(</span><span class='id session'>session</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>UnrevertableAction</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="call-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>call</strong> {|a, session| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Executes the action. This is a wrapper around _call_in_session, and it
shouldn't be overriden. A block can be passed to  be evaluated with the
session after the save session been saved. This is usefull to get ids of
saved object. False will be returned if the action failed (or parameters
are invalid)</p>


  </div>
</div>
<div class="tags">
  
<h3>Yield Parameters:</h3>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>a</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Action.html" title="Lims::Core::Actions::Action (module)">Action</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>session</span>
      
      
        <span class='type'>(<tt>Session</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the current session.</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>the value return by the block</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/actions/action.rb', line 57</span>

<span class='kw'>def</span> <span class='id call'>call</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id after_save'>after_save</span><span class='rparen'>)</span>
  <span class='id with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id session'>session</span><span class='op'>|</span> 
    <span class='id execute_and_store_result'>execute_and_store_result</span><span class='lparen'>(</span><span class='id session'>session</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id after_save'>after_save</span><span class='rparen'>)</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id andtap'>andtap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id block'>block</span><span class='op'>|</span> <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Lims::Core::Actions::Action::AfterEval (module)">AfterEval</a></span></tt>) <strong>initialize</strong>(*args, &amp;initializer) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Initialize a new actions 'Common' parameters are set as argument whereas
specific ones are set on a dummy object via the block. The block is
executed within a session allowing to find object form id, etc.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/actions/action.rb', line 43</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id initializer'>initializer</span><span class='rparen'>)</span>
  <span class='ivar'>@initializer</span> <span class='op'>=</span> <span class='id initializer'>initializer</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="revert-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>revert</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Execute the opposite of the action if possible. This a wrapper around
_revert_in_session, and shouldn't be overriden.</p>


  </div>
</div>
<div class="tags">
  
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>UnrevertableAction</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/actions/action.rb', line 78</span>

<span class='kw'>def</span> <span class='id revert'>revert</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id with_session'>with_session</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id s'>s</span><span class='op'>|</span> <span class='id _revert_in_session'>_revert_in_session</span><span class='lparen'>(</span><span class='id s'>s</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="with_session-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>, <tt>False</tt>) <strong>with_session</strong>(*args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Execute the given block within a new session. Validates the action and fill
#errors if needed</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>, <tt>False</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lims-core/actions/action.rb', line 85</span>

<span class='kw'>def</span> <span class='id with_session'>with_session</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
    <span class='ivar'>@store</span><span class='period'>.</span><span class='id with_session'>with_session</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id session'>session</span><span class='op'>|</span>
      <span class='comment'># initialize action
</span>      <span class='kw'>if</span> <span class='ivar'>@initializer</span>
        <span class='id params'>params</span> <span class='op'>=</span> <span class='const'>OpenStruct</span><span class='period'>.</span><span class='id new'>new</span>
        <span class='ivar'>@initializer</span><span class='lbracket'>[</span><span class='id params'>params</span><span class='comma'>,</span> <span class='id session'>session</span><span class='rbracket'>]</span>
        <span class='id set_attributes'>set_attributes</span><span class='lparen'>(</span><span class='id params'>params</span><span class='rparen'>)</span>
        <span class='ivar'>@initializer</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>

      <span class='comment'># Note: there is a bug in Aequitas gem on the valid?
</span>      <span class='comment'># method call. For an attribute which needs to be required
</span>      <span class='comment'># and greater than 0, the greater than 0 is tested first
</span>      <span class='comment'># and the required after. So if the parameter is not set, 
</span>      <span class='comment'># nil &gt;= 0 is evaluated by Aequitas and an exception is 
</span>      <span class='comment'># raised. We catch it here and raise an InvalidParameters error.
</span>      <span class='id is_valid'>is_valid</span> <span class='op'>=</span> <span class='kw'>begin</span> 
      <span class='id valid?'>valid?</span>
    <span class='kw'>rescue</span>
      <span class='id raise'>raise</span> <span class='const'>InvalidParameters</span><span class='period'>.</span><span class='id new'>new</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id is_valid'>is_valid</span>
      <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span><span class='id session'>session</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id invalid_parameters'>invalid_parameters</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id hash'>hash</span><span class='op'>|</span>
        <span class='id errors'>errors</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id key'>key</span><span class='op'>|</span>
          <span class='id hash'>hash</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id array'>array</span><span class='op'>|</span>
            <span class='comment'># errors[key] returns an array of Aequitas::Violation
</span>            <span class='id errors'>errors</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id error'>error</span><span class='op'>|</span>
              <span class='id array'>array</span> <span class='op'>&lt;&lt;</span> <span class='id error'>error</span><span class='period'>.</span><span class='id message'>message</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='id raise'>raise</span> <span class='const'>InvalidParameters</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id invalid_parameters'>invalid_parameters</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    
  </body>
</html>